<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz zum kritischen Denken</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax für LaTeX-Formeln -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* NEUE HINTERGRUNDFARBE: Honeydew */
            background-color: #E2EFDE; 
        }
        .progress-bar-container {
            width: 100%;
            display: flex;
            gap: 4px;
            margin-bottom: 1.5rem;
        }
        .progress-segment {
            flex: 1;
            height: 12px;
            /* NEUE STANDARD-FARBE (Battleship Gray - leicht heller für Kontrast) */
            background-color: #AAB7B2; /* #808F87 etwas aufgehellt */
            border-radius: 9999px;
            transition: background-color 0.5s ease-in-out;
            cursor: pointer;
        }
        /* Eigene Klasse für den Hinweis-Button */
        .hint-button {
            position: fixed; /* Position fixed, damit er bei Recherchefragen immer sichtbar ist */
            bottom: 2rem; /* Abstand vom unteren Rand */
            right: 2rem; /* Abstand vom rechten Rand */
            width: 50px; /* etwas größer gemacht */
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* NEUE PRIMÄRFARBE: Chamoisee */
            background-color: #9B7E46; 
            color: white;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s, transform 0.1s;
            z-index: 1000; /* Stellt sicher, dass er über allem liegt */
        }
        .hint-button:hover {
            background-color: #81693A;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-[#E2EFDE] min-h-screen flex items-center justify-center p-4">

    <!-- NEUER NERVEN-OVERLAY: 30 Switches und CAPTCHA -->
    <div id="privacy-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-95 z-[9999] flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto">
            <h2 class="text-3xl font-extrabold text-red-600 mb-4 text-center border-b-4 border-red-400 pb-2">❌ ACHTUNG! Persönliche Daten! ❌</h2>
            <p class="text-gray-700 mb-6 text-center text-sm font-semibold">Wir nutzen 30 essenzielle und optionale Tracker, um Ihr kritisches Denkverhalten zu analysieren. Bitte passen Sie jede Einstellung manuell an, um fortzufahren.</p>

            <div id="cookie-switches-container" class="space-y-3 mb-6 p-4 border rounded-lg max-h-64 overflow-y-auto bg-gray-50">
                <!-- 30 Switches werden hier von JS eingefügt -->
            </div>
            
            <div id="captcha-area" class="bg-yellow-100 p-4 rounded-lg mb-6 border border-yellow-400">
                <p class="font-bold text-gray-800 mb-2">Bevor Sie fortfahren, lösen Sie bitte dieses CAPTCHA:</p>
                <label id="captcha-question" class="block text-xl font-mono mb-2 text-center text-red-700"></label>
                <input type="text" id="captcha-input" placeholder="Geben Sie Ihre Antwort hier ein" class="w-full p-2 border rounded-md focus:ring-[#9B7E46] focus:border-[#9B7E46]">
                <p id="captcha-feedback" class="text-sm mt-2 hidden font-semibold"></p>
            </div>

            <!-- Button wird erst aktiv, wenn alle 30 Toggles akzeptiert sind -->
            <button id="confirm-annoyance-button" class="bg-red-500 text-white font-semibold py-3 px-6 text-lg rounded-lg shadow-lg w-full transition-colors opacity-50 cursor-not-allowed" disabled>
                0 von 30 Einstellungen akzeptiert.
            </button>
        </div>
    </div>

    <!-- Container auf Desktop breiter gemacht (max-w-4xl) -->
    <div id="quiz-container" class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-xl md:max-w-4xl mx-auto m-4">
        <!-- NEUE TITELFARBE: Battleship Gray -->
        <h1 class="text-4xl font-extrabold text-[#808F87] text-center mb-8">Quiz zum kritischen Denken</h1>
        
        <!-- Start Screen (Ist standardmäßig versteckt, bis die Hürden genommen sind) -->
        <div id="start-screen" class="hidden text-center p-8 space-y-6">
            <p class="text-xl text-gray-700">Willkommen zum Quiz! Teste dein Wissen über kritisches Denken und das Bewerten von Informationen.</p>
            <!-- NEUE PRIMÄRFARBE: Chamoisee -->
            <button id="start-button" class="bg-[#9B7E46] text-white font-semibold py-4 px-8 text-lg rounded-lg shadow-lg hover:bg-[#81693A] transition-colors w-full md:w-auto">
                Quiz starten
            </button>
        </div>

        <!-- Quiz Area -->
        <div id="quiz-area" class="hidden">
            <!-- Progress Bar -->
            <div id="progress-bar-container" class="progress-bar-container">
            </div>
            
            <div class="flex justify-between items-baseline mb-4">
                <!-- Versuchsanzeige links -->
                <div id="feedback-attempts" class="text-lg font-semibold text-gray-600"></div>
                 <!-- Fragen-Zähler zentriert -->
                <p id="question-counter" class="text-md font-medium text-gray-500"></p>
            </div>


            <!-- Question Area -->
            <div id="question-area" class="space-y-6">
                <!-- Questions will be injected here -->
            </div>
            
            <!-- Dynamisch eingeblendete Tipps -->
            <div id="hint-display" class="hidden mt-4 p-4 rounded-lg bg-[#AFD0BF] text-gray-800 border border-[#9B7E46]">
                <p class="font-bold">Tipp zur Recherche:</p>
                <p id="hint-text"></p>
            </div>

            <!-- Feedback & Navigation -->
            <div class="mt-10 text-center space-y-4">
                <div id="feedback" class="text-xl font-bold mb-4"></div>
                <!-- Buttons sind auf Desktop nebeneinander und zentriert -->
                <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <!-- NEUE SUCCESS-FARBE (Weiter/Richtig): Ash Gray -->
                    <button id="next-button" class="bg-[#AFD0BF] text-gray-800 font-semibold py-3 px-6 text-lg rounded-lg shadow-md hover:bg-[#9BB4A8] transition-colors hidden w-full sm:w-auto">Nächste Frage</button>
                    <!-- NEUE SKIP/SEKUNDÄRFARBE: Battleship Gray -->
                    <button id="skip-button" class="bg-[#808F87] text-white font-semibold py-3 px-6 text-lg rounded-lg shadow-md hover:bg-[#68766F] transition-colors hidden w-full sm:w-auto">Frage überspringen</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Schwebender Hint Button, der nur bei Recherchefragen eingeblendet wird -->
    <button id="floating-hint-button" class="hint-button hidden">?</button>

    <script>
        // --- Globale Variablen für CAPTCHA und Cookies ---
        const privacyOverlay = document.getElementById('privacy-overlay');
        const cookieSwitchesContainer = document.getElementById('cookie-switches-container');
        const confirmAnnoyanceButton = document.getElementById('confirm-annoyance-button');
        const captchaQuestionElement = document.getElementById('captcha-question');
        const captchaInputElement = document.getElementById('captcha-input');
        const captchaFeedbackElement = document.getElementById('captcha-feedback');
        
        let acceptedCookiesCount = 0;
        const TOTAL_COOKIES = 30;
        let correctAnswer = 0;

        // --- 1. CAPTCHA Logik ---
        function generateCaptcha() {
            const num1 = Math.floor(Math.random() * 50) + 10; // 10-59
            const num2 = Math.floor(Math.random() * 40) + 5;  // 5-44
            correctAnswer = num1 + num2;
            captchaQuestionElement.textContent = `Was ist ${num1} + ${num2}?`;
        }

        function checkCaptcha() {
            const userAnswer = parseInt(captchaInputElement.value.trim(), 10);
            return userAnswer === correctAnswer;
        }

        // --- 2. Cookie Wall Daten (30 Stück) ---
        const cookieNames = [
            "Essenzielle Tracker (Muss)", "Leistungsanalyse (Optional)", "Marketing-Cookies (Optional)", 
            "Drittanbieter-Tracking (Optional)", "Standortdaten (Optional)", "Biometrische Analyse (Optional)",
            "Eye-Tracking (Optional)", "Mausbewegungs-Recorder (Optional)", "Tastatureingabe-Logger (Optional)",
            "Kaufabsichts-Predictor (Optional)", "Affinitäts-Segmentierung (Optional)", "Social Media Integration (Optional)",
            "Personalisierte Werbung (Optional)", "A/B Testing (Optional)", "Fehlerberichterstattung (Optional)",
            "Server-Ladezeiten (Optional)", "Session-Recording (Optional)", "Heatmap-Analyse (Optional)",
            "Font-Loading-Optimierung (Optional)", "Browser-Fingerprinting (Optional)", "Pixel-Perfect Tracking (Optional)",
            "Zustimmungs-Synchronisation (Optional)", "Wetterdaten-Abfrage (Optional)", "Stimmungserkennung (Optional)",
            "Krypto-Mining-Optimierung (Optional)", "Hintergrund-Video-Autoplay (Optional)", "Benutzerprofil-Erstellung (Optional)",
            "Automatisierte E-Mail-Erfassung (Optional)", "Unverzichtbare Sicherheits-Token (Muss)", "Funktionale Präferenzen (Muss)"
        ];

        // --- 3. Rendering und Logik der Switches ---
        function renderCookieSwitches() {
            cookieSwitchesContainer.innerHTML = '';
            cookieNames.forEach((name, index) => {
                const isEssential = name.includes('(Muss)');
                
                const item = document.createElement('div');
                item.classList.add('flex', 'justify-between', 'items-center', 'py-2', 'rounded-md', 'border-b', 'border-gray-200');
                
                // Styling für den Schalter
                item.innerHTML = `
                    <span class="text-gray-800">${name}</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" data-index="${index}" class="sr-only peer" ${isEssential ? 'checked disabled' : ''}>
                        <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-red-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                    </label>
                `;
                cookieSwitchesContainer.appendChild(item);
            });

            const checkboxes = cookieSwitchesContainer.querySelectorAll('input[type="checkbox"]');
            // Zähle die standardmäßig aktivierten (Muss)
            acceptedCookiesCount = Array.from(checkboxes).filter(cb => cb.checked).length;

            checkboxes.forEach(checkbox => {
                if (!checkbox.disabled) {
                    checkbox.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            acceptedCookiesCount++;
                        } else {
                            // Deaktivieren führt zum Zwang, erneut zu aktivieren
                            acceptedCookiesCount--;
                        }
                        checkPrerequisites();
                    });
                }
            });
        }

        // --- 4. Hauptprüfung (Cookie-Wall) ---
        function checkPrerequisites() {
            // Es müssen alle 30 Checkboxen akzeptiert sein
            const allSwitchesAccepted = acceptedCookiesCount === TOTAL_COOKIES;
            
            if (allSwitchesAccepted) {
                confirmAnnoyanceButton.disabled = false;
                confirmAnnoyanceButton.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-red-500');
                confirmAnnoyanceButton.classList.add('hover:bg-green-700', 'bg-green-600');
                confirmAnnoyanceButton.textContent = 'Alle 30 Einstellungen akzeptiert! CAPTCHA lösen...';
            } else {
                confirmAnnoyanceButton.disabled = true;
                confirmAnnoyanceButton.classList.add('opacity-50', 'cursor-not-allowed', 'bg-red-500');
                confirmAnnoyanceButton.classList.remove('hover:bg-green-700', 'bg-green-600');
                confirmAnnoyanceButton.textContent = `${acceptedCookiesCount} von ${TOTAL_COOKIES} Einstellungen akzeptiert.`;
            }
        }

        // --- 5. Initialisierung und Event-Listener ---
        document.addEventListener('DOMContentLoaded', () => {
            
            const startScreen = document.getElementById('start-screen');
            const startButton = document.getElementById('start-button');
            const quizArea = document.getElementById('quiz-area');
            const questionArea = document.getElementById('question-area');
            const feedbackElement = document.getElementById('feedback');
            const feedbackAttempts = document.getElementById('feedback-attempts'); 
            const nextButton = document.getElementById('next-button');
            const skipButton = document.getElementById('skip-button');
            const progressBarContainer = document.getElementById('progress-bar-container');
            const questionCounterElement = document.getElementById('question-counter');
            const hintDisplay = document.getElementById('hint-display');
            const hintText = document.getElementById('hint-text');
            const floatingHintButton = document.getElementById('floating-hint-button');
            
            // Initialisiere die nervigen Komponenten sofort
            generateCaptcha();
            renderCookieSwitches();
            checkPrerequisites(); // Checkt den Anfangszustand

            confirmAnnoyanceButton.addEventListener('click', () => {
                if (confirmAnnoyanceButton.disabled) return;
                
                if (checkCaptcha()) {
                    captchaFeedbackElement.classList.remove('hidden', 'text-red-500');
                    captchaFeedbackElement.classList.add('text-green-600');
                    captchaFeedbackElement.textContent = 'CAPTCHA erfolgreich gelöst! Endlich...';
                    
                    // Verzögerung, um den Erfolg anzuzeigen
                    setTimeout(() => {
                        privacyOverlay.classList.add('hidden');
                        startScreen.classList.remove('hidden'); // Zeigt den eigentlichen Startbildschirm
                    }, 1000);
                    
                } else {
                    captchaFeedbackElement.classList.remove('hidden', 'text-green-600');
                    captchaFeedbackElement.classList.add('text-red-500');
                    captchaFeedbackElement.textContent = 'Falsche Antwort! Bitte versuchen Sie es erneut. (Neues CAPTCHA generiert)';
                    generateCaptcha(); // Neues CAPTCHA
                    captchaInputElement.value = '';
                }
            });


            // --- HINWEIS: HIER STARTEN DIE FRAGEN-DATEN ---
            const quizData = [
                // ----------------------------------------------------
                // NEUE ALGEBRA-FRAGE (TEXT-TYP)
                // ----------------------------------------------------
                {
                    type: 'text',
                    // Die Formel wird dank MathJax korrekt dargestellt
                    question: 'Multiplizieren Sie den folgenden Ausdruck aus und vereinfachen Sie das Ergebnis (Distributivgesetz): $$(4x-4y) \\cdot (-3a)$$',
                    placeholder: 'Geben Sie das Ergebnis ein (z.B. -12ax + 12ay)...',
                    correctAnswer: '$-12ax + 12ay$',
                    correctAnswerCheck: (userAnswer) => {
                        // Normiert die Eingabe: entfernt alle Leerzeichen, macht alles klein, ersetzt * durch nichts
                        let normalizedInput = userAnswer.toLowerCase().replace(/\s/g, '').replace(/\*/g, '');

                        // Erwartete Form 1: -12ax+12ay
                        const form1 = normalizedInput.includes('-12ax') && normalizedInput.includes('+12ay');
                        
                        // Erwartete Form 2 (Reihenfolge getauscht): 12ay-12ax
                        const form2 = normalizedInput.includes('12ay') && normalizedInput.includes('-12ax');
                        
                        // Prüft, ob beide Terme enthalten sind (inkl. Vorzeichen), unabhängig von der Reihenfolge
                        return (form1 || form2) && normalizedInput.length >= 10;
                    },
                    explanation: 'Die Lösung erfolgt durch das **Distributivgesetz**: $$(4x \\cdot (-3a)) + (-4y \\cdot (-3a)) = (-12ax) + (12ay) = -12ax + 12ay.$$ Achten Sie auf die Vorzeichenregeln: Minus mal Minus ergibt Plus.',
                    hint: 'Wenden Sie das **Distributivgesetz** an: Multiplizieren Sie $4x$ mit $(-3a)$ und $-4y$ mit $(-3a)$. Achten Sie dabei besonders auf die **Vorzeichen**! Die korrekte Lösung ist $$-12ax + 12ay.$$'
                },
                // ----------------------------------------------------
                // RECHERCHE-FRAGEN (Typ: text) - 3 VERSUCHE
                // ----------------------------------------------------
                {
                    type: 'text',
                    question: 'Suchen Sie auf der Website des Deutschen Bundestags (bundestag.de) nach Dokumenten im PDF-Format, die das Wort „Lobbyismus“ enthalten. Schreiben Sie eine mögliche URL eines solchen Dokuments auf.',
                    placeholder: 'Geben Sie eine URL ein...',
                    correctAnswer: 'Mögliche URL: https://www.bundestag.de/...',
                    correctAnswerCheck: (userAnswer) => {
                        return userAnswer.toLowerCase().includes('bundestag.de') && userAnswer.toLowerCase().includes('pdf') && userAnswer.toLowerCase().includes('lobbyism');
                    },
                    explanation: 'Die korrekte Suchanfrage wäre `site:bundestag.de filetype:pdf Lobbyismus`. Die URL muss auf der Seite des Bundestags liegen und den Dateityp PDF anzeigen.',
                    // Besserer Tipp
                    hint: 'Verwenden Sie Suchoperatoren. Die korrekte Syntax lautet: `[Suchbegriff] site:[Webseite] filetype:[Dateiformat]`. Beispiel: `Lobbyismus site:bundestag.de filetype:pdf`'
                },
                {
                    type: 'text',
                    question: 'Recherchieren Sie die Bevölkerungszahl der Schweiz im Jahr 2023. Nennen Sie die Zahl und die staatliche oder seriöse Quelle (Name der Organisation oder Webseite), die diese Zahl veröffentlicht hat.',
                    placeholder: 'Geben Sie Zahl und Quelle (z.B. 8.9 Mio, Bundesamt für Statistik) ein...',
                    correctAnswer: 'Zahl: ca. 8.8 bis 8.9 Mio. Quelle: z.B. Bundesamt für Statistik (BFS)',
                    correctAnswerCheck: (userAnswer) => {
                        const plausibleNumber = /(8[\.,]\d|9)[\s]?mio/i.test(userAnswer) || /(8|9)[\s]?millionen/i.test(userAnswer) || /\d{7,8}/.test(userAnswer.replace(/\D/g, ''));
                        const officialSource = /statistik|bfs|admin\.ch|bundesamt/i.test(userAnswer);
                        return plausibleNumber && officialSource;
                    },
                    explanation: 'Die Zahl sollte zwischen 8.8 und 8.9 Millionen liegen (Stand 2023). Eine seriöse Quelle ist das Bundesamt für Statistik (BFS) oder die offizielle Webseite des Bundes `admin.ch`. Schätzungen oder nicht-offizielle Quellen sind weniger vertrauenswürdig.',
                    // Besserer Tipp
                    hint: 'Achten Sie auf das **CRAAP-Kriterium Autorität** (Authority). Suchen Sie gezielt nach **staatlichen Institutionen** oder **nationalen Statistikämtern**, um die verlässlichste Quelle zu finden.'
                },
                {
                    type: 'text',
                    question: 'Finden Sie einen Nachrichtenartikel, der **vor 2020** veröffentlicht wurde und den **genauen Satz** "Klimawandel als ernste Bedrohung" enthält. Nennen Sie das Veröffentlichungsjahr und den Namen der Quelle (Zeitung/Webseite).',
                    placeholder: 'Geben Sie Jahr und Quelle (z.B. 2018, Der Spiegel) ein...',
                    correctAnswer: 'Verschiedene Ergebnisse möglich. Beispiel: 2019, NZZ oder ähnliche große Zeitung.',
                    correctAnswerCheck: (userAnswer) => {
                        const hasYear = /(201\d|200\d)/.test(userAnswer);
                        const hasSource = /spiegel|zeit|süddeutsche|faz|nzz|bbc|tagesschau/i.test(userAnswer) || userAnswer.split(/[\s,]+/).filter(w => w.length > 3).length > 1; 
                        return hasYear && hasSource;
                    },
                    explanation: 'Dies erforderte die Suchanfrage `"Klimawandel als ernste Bedrohung"` und die Einschränkung des Zeitraums (z.B. über die Google-Suchwerkzeuge oder den Suchoperator `before:2020`).',
                    // Besserer Tipp
                    hint: 'Um nach einer **exakten Phrase** zu suchen, verwenden Sie **Anführungszeichen** (`" "`). Sie müssen zusätzlich die Google-**Suchwerkzeuge** nutzen, um den Zeitraum auf **vor 2020** einzuschränken.'
                },
                {
                    type: 'text',
                    question: 'Suchen Sie nach der Bedeutung des Begriffs "Ad-Hominem-Argument" und nennen Sie eine Quelle, die nach dem CRAAP-Test als **Autorität** für philosophische oder logische Begriffe gilt (z.B. Universität, Fachlexikon).',
                    placeholder: 'Geben Sie die seriöse Quelle ein (z.B. Uni Heidelberg, Philosophie-Lexikon)...',
                    correctAnswer: 'Eine Universität, ein Fachlexikon oder eine seriöse wissenschaftliche Seite zur Logik.',
                    correctAnswerCheck: (userAnswer) => {
                        const authoritativeKeywords = /uni|universität|akademisch|lexikon|fachbuch|stanford|philosophie|logik/i.test(userAnswer);
                        return authoritativeKeywords;
                    },
                    explanation: 'Beim Kriterium "Autorität" des CRAAP-Tests ist es wichtig, dass der Autor oder die Organisation Fachwissen auf dem jeweiligen Gebiet besitzt. Für Argumentationstheorie sind dies Hochschulen, Fachgesellschaften oder anerkannte Lexika.',
                    // Besserer Tipp
                    hint: 'Fokus auf das **CRAAP-Kriterium Autorität**. Wer hat die höchste Expertise in Logik und Philosophie? Suchen Sie nach Quellen mit dem Begriff **"Universität"**, **"Fachlexikon"** oder **"Akademie"**.'
                },
                {
                    type: 'text',
                    question: 'Verwenden Sie den Suchoperator `-` (minus), um nach Rezepten für "Apfelkuchen" zu suchen, aber **ohne** die Begriffe "Zimt" und "Streusel". Schreiben Sie einen kurzen, abgewandelten Rezepttitel auf, den Sie gefunden haben.',
                    placeholder: 'Geben Sie den gefundenen Rezepttitel ein (z.B. Einfacher Apfelkuchen mit Guss)...',
                    correctAnswer: 'Ein Rezepttitel für Apfelkuchen ohne Zimt und Streusel.',
                    correctAnswerCheck: (userAnswer) => {
                        return userAnswer.toLowerCase().includes('apfelkuchen') && !userAnswer.toLowerCase().includes('zimt') && !userAnswer.toLowerCase().includes('streusel');
                    },
                    explanation: 'Die Suchanfrage muss lauten: `Apfelkuchen -Zimt -Streusel`. Der gefundene Titel sollte beides ausschließen, um als richtig gewertet zu werden.',
                    // Besserer Tipp
                    hint: 'Nutzen Sie den **Ausschluss-Operator** (`-`). Setzen Sie das Minuszeichen direkt vor die Wörter, die Sie in den Suchergebnissen vermeiden möchten. Die Suchanfrage lautet: `Apfelkuchen -[Begriff 1] -[Begriff 2]`.'
                },
                // --- Alte Recherchefragen, nun mit 3 Versuchen und Hinweisen ---
                {
                    type: 'text',
                    question: 'Finden Sie alle Seiten auf der Website der Bundeszentrale für politische Bildung (bpb.de), die sich mit dem Thema „Propaganda“ beschäftigen. (Tipp: Verwenden Sie den site: Operator). Schreiben Sie unten die URL einer der Websites auf.',
                    placeholder: 'Geben Sie eine URL ein...',
                    correctAnswer: 'https://www.bpb.de/themen/medien-journalismus/bpb-im-unterricht/277051/faktencheck-propaganda/',
                    correctAnswerCheck: (userAnswer, correctAnswer) => {
                        return userAnswer.toLowerCase().includes('bpb.de') && userAnswer.toLowerCase().includes('propaganda');
                    },
                    explanation: 'Eine mögliche URL ist: `https://www.bpb.de/themen/medien-journalismus/bpb-im-unterricht/277051/faktencheck-propaganda/`. Sie konnten die richtige Antwort finden, indem Sie in der Google-Suche `site:bpb.de propaganda` eingegeben haben.',
                    // Besserer Tipp
                    hint: 'Um die Suche nur auf eine **bestimmte Webseite** zu beschränken, verwenden Sie den Operator `site:`. Die korrekte Syntax lautet: `[Suchbegriff] site:[Webseite]`. Beispiel: `Propaganda site:bpb.de`.'
                },
                {
                    type: 'text',
                    question: 'Suchen Sie nach der genauen Phrase „Der Bestätigungsfehler ist die Neigung, eine vorgefasste Meinung beizubehalten“. Welche seriöse Quelle finden Sie? (Nutzen Sie den CRAAP-Test)',
                    placeholder: 'Geben Sie eine seriöse Quelle ein...',
                    correctAnswer: 'Eine Universität oder wissenschaftliche Einrichtung.',
                    correctAnswerCheck: (userAnswer, correctAnswer) => {
                        const keywords = ['uni', 'universität', 'hochschule', 'wissenschaftlich', 'akademisch', 'psychologie', 'markschweizer.ch'];
                        return keywords.some(keyword => userAnswer.toLowerCase().includes(keyword));
                    },
                    explanation: 'Eine seriöse Quelle für dieses Thema ist in der Regel eine Universität, eine andere wissenschaftliche Einrichtung oder eine akademische Webseite wie z.B. https://www.markschweizer.ch/. Diese Quellen erfüllen die Kriterien des CRAAP-Tests, insbesondere im Hinblick auf Autorität und Genauigkeit.',
                    // Besserer Tipp
                    hint: 'Verwenden Sie die **Anführungszeichen** (`" "`) für die exakte Phrase. Achten Sie auf das **CRAAP-Kriterium Autorität** – suchen Sie nach psychologischen oder akademischen Quellen (z.B. Universitäten).'
                },
                {
                    type: 'text',
                    question: 'Suchen Sie nach dem Begriff „Jaguar Geschwindigkeit“, schließen Sie jedoch Ergebnisse aus, die mit dem Auto zu tun haben. Wie schnell ist ein Jaguar? Notieren Sie die maximale Geschwindigkeit.',
                    placeholder: 'Geben Sie die Geschwindigkeit in km/h ein (z.B. 80 km/h)...',
                    correctAnswer: 'Ca. 50-80 km/h (bei Sprints bis zu 90 km/h)',
                    correctAnswerCheck: (userAnswer) => {
                        // Prüft, ob eine plausible Zahl (50-90) und km/h genannt werden und das Auto ausgeschlossen wird
                        const plausibleSpeed = /(5\d|6\d|7\d|8\d|90)[\s]?km\/h/i.test(userAnswer);
                        const excludedCar = !userAnswer.toLowerCase().includes('auto') && !userAnswer.toLowerCase().includes('jaguar f-pace');
                        return plausibleSpeed && excludedCar;
                    },
                    explanation: 'Die korrekte Suchanfrage lautet: `Jaguar Geschwindigkeit -Auto`. Der Jaguar erreicht eine Geschwindigkeit von bis zu 50-60 km/h, kann aber bei kurzen Sprints bis zu 80-90 km/h erreichen.',
                    // Besserer Tipp
                    hint: 'Nutzen Sie den **Ausschluss-Operator** (`-`), um Begriffe, die mit dem Autohersteller "Jaguar" zu tun haben, zu vermeiden. Die Suchanfrage sollte lauten: `Jaguar Geschwindigkeit -Auto`.'
                },
                {
                    type: 'text',
                    question: 'Finden Sie eine PDF-Datei auf der Website der Weltgesundheitsorganisation (who.int) zum Thema „Pandemie“. Schreiben Sie eine mögliche URL auf.',
                    placeholder: 'Geben Sie eine URL ein...',
                    correctAnswer: 'https://www.who.int/docs/default-source/coronaviruse/who-nCoV-SOP-V1.0.pdf',
                    correctAnswerCheck: (userAnswer) => {
                        return userAnswer.toLowerCase().includes('who.int') && userAnswer.toLowerCase().includes('pdf') && userAnswer.toLowerCase().includes('pandemic');
                    },
                    explanation: 'Sie können dies finden, indem Sie in der Google-Suche `site:who.int filetype:pdf pandemie` eingeben.',
                    // Besserer Tipp
                    hint: 'Verwenden Sie Suchoperatoren. Die korrekte Syntax lautet: `[Suchbegriff] site:[Webseite] filetype:[Dateiformat]`. Beispiel: `Pandemie site:who.int filetype:pdf`.'
                },
                // ----------------------------------------------------
                // MULTIPLE CHOICE (2 VERSUCHE) - Unverändert
                // ----------------------------------------------------
                {
                    type: 'multiple-choice',
                    question: 'Was ist der Hauptgrund, warum ein Wikipedia-Artikel für eine wissenschaftliche Arbeit oft nicht als alleinige Primärquelle geeignet ist?',
                    options: [
                        { text: 'Die Artikel sind zu lang und enthalten zu viele Informationen.', isCorrect: false },
                        { text: 'Die Informationen werden von der Community bearbeitet und können sich schnell ändern, was ihre Zitierfähigkeit als Primärquelle beeinträchtigt.', isCorrect: true },
                        { text: 'Wikipedia-Artikel sind zu allgemein und haben keine spezifischen Themen.', isCorrect: false },
                        { text: 'Die Website ist oft nicht verfügbar, was das Überprüfen der Quellen erschwert.', isCorrect: false }
                    ],
                    explanation: 'Da Wikipedia-Artikel von einer Gemeinschaft bearbeitet werden und sich ständig ändern, gelten sie nicht als verlässliche Primärquellen für wissenschaftliche Arbeiten. Stattdessen sollten die Quellen, die im Literaturverzeichnis des Wikipedia-Artikels aufgeführt sind, herangezogen werden.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Was ist der Zweck des CRAAP-Tests?',
                    options: [
                        { text: 'Um die Qualität einer wissenschaftlichen Arbeit zu bewerten.', isCorrect: false },
                        { text: 'Um die Glaubwürdigkeit und Verlässlichkeit einer Quelle zu beurteilen.', isCorrect: true },
                        { text: 'Um die Anzahl der Quellen in einem Dokument zu zählen.', isCorrect: false },
                        { text: 'Um die Relevanz einer Quelle für eine bestimmte Frage zu bestimmen.', isCorrect: false }
                    ],
                    explanation: 'Der CRAAP-Test dient dazu, die Glaubwürdigkeit und Verlässlichkeit von Quellen zu beurteilen, indem er Aktualität (Currency), Relevanz (Relevance), Autorität (Authority), Genauigkeit (Accuracy) und Zweck (Purpose) überprüft.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Was ist ein Merkmal einer Falschmeldung (Fake News)?',
                    options: [
                        { text: 'Eine objektive und sachliche Sprache.', isCorrect: false },
                        { text: 'Die Verwendung von übertriebener, emotional aufgeladener Sprache wie „UNGLAUBLICH!“ oder „OMG!“.', isCorrect: true },
                        { text: 'Eine genaue Angabe der Quellen.', isCorrect: false },
                        { text: 'Eine nüchterne und sachliche Überschrift.', isCorrect: false }
                    ],
                    explanation: 'Falschmeldungen verwenden oft sensationalistische und emotionale Sprache, um die Aufmerksamkeit zu erregen und zum Teilen zu animieren.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Nach dem CRAAP-Test: Wenn eine Webseite in ihrem Impressum keine Autoren oder Verantwortlichen angibt, was macht die Quelle wahrscheinlich?',
                    options: [
                        { text: 'Die Quelle ist vertrauenswürdig, da es keine kommerziellen Interessen gibt.', isCorrect: false },
                        { text: 'Die Quelle ist unzuverlässig, da die Autorenschaft nicht geprüft werden kann.', isCorrect: true },
                        { text: 'Die Quelle ist nur für bestimmte wissenschaftliche Fachbereiche unzuverlässig.', isCorrect: false },
                        { text: 'Die Quelle kann vertrauenswürdig sein, wenn der Text keine Rechtschreibfehler enthält.', isCorrect: false }
                    ],
                    explanation: 'Das Fehlen von Autoren oder einer verantwortlichen Organisation ist ein wichtiges Warnsignal im Rahmen des CRAAP-Tests, da die Glaubwürdigkeit und Fachkenntnis der Verfasser nicht beurteilt werden können.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Was beschreibt der Bestätigungsfehler?',
                    options: [
                        { text: 'Die Neigung, neue Meinungen schnell zu übernehmen, ohne sie zu hinterfragen.', isCorrect: false },
                        { text: 'Die Fähigkeit, objektive Informationen von falschen Informationen zu unterscheiden.', isCorrect: false },
                        { text: 'Die unbewusste Neigung, Informationen zu suchen, zu interpretieren und zu bevorzugen, die die eigenen Überzeugungen bestätigen.', isCorrect: true },
                        { text: 'Das bewusste Ignorieren von Informationen, die den eigenen Ansichten widersprechen.', isCorrect: false }
                    ],
                    explanation: 'Der Bestätigungsfehler ist die Tendenz, Informationen zu suchen und zu bevorzugen, die die eigenen Vorurteile und Überzeugungen bestätigen.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Wofür wird der Suchoperator `filetype:` in der Google-Suche hauptsächlich verwendet?',
                    options: [
                        { text: 'Er beschränkt die Suche auf Textdateien.', isCorrect: false },
                        { text: 'Er beschränkt die Suche auf einen bestimmten Dateityp, zum Beispiel auf eine PDF-Datei.', isCorrect: true },
                        { text: 'Er hilft bei der Suche nach Videos und Bildern.', isCorrect: false },
                        { text: 'Er beschränkt die Suche auf die letzten 24 Stunden.', isCorrect: false }
                    ],
                    explanation: 'Der `filetype:`-Operator beschränkt die Google-Suche auf Dokumente eines bestimmten Dateityps, wie PDF, DOCX oder PPTX.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Was ist der Unterschied zwischen einer Primärquelle und einer Sekundärquelle?',
                    options: [
                        { text: 'Eine Primärquelle enthält die Originaldaten, während eine Sekundärquelle diese Daten interpretiert oder analysiert.', isCorrect: true },
                        { text: 'Eine Primärquelle ist eine Online-Quelle, während eine Sekundärquelle eine gedruckte Buch ist.', isCorrect: false },
                        { text: 'Primärquellen sind immer seriöser als Sekundärquellen.', isCorrect: false },
                        { text: 'Eine Sekundärquelle wird von einer staatlichen Organisation veröffentlicht.', isCorrect: false }
                    ],
                    explanation: 'Eine Primärquelle ist ein Originalwerk oder eine Originaldokumentation. Eine Sekundärquelle ist eine Interpretation oder Analyse von Primärquellen, wie z. B. eine Rezension, ein Lehrbuch oder ein Artikel, der eine Primärquelle zitiert.'
                },
                 {
                    type: 'multiple-choice',
                    question: 'Wenn eine Quelle hauptsächlich emotionale Appelle nutzt, ist ihr Hauptzweck wahrscheinlich, zu informieren?',
                    options: [
                        { text: 'Ja.', isCorrect: false },
                        { text: 'Nein.', isCorrect: true }
                    ],
                    explanation: 'Nein, nach dem CRAAP-Test ist eine Quelle, die emotionale Appelle verwendet, wahrscheinlich unzuverlässig, da der Zweck in der Regel eher darin besteht, eine Meinung zu beeinflussen oder eine bestimmte Reaktion hervorzurufen, als sachlich zu informieren.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Führt der Bestätigungsfehler dazu, dass man unbewusst nach Informationen sucht, die die eigene Meinung bestätigen?',
                    options: [
                        { text: 'Ja.', isCorrect: true },
                        { text: 'Nein.', isCorrect: false }
                    ],
                    explanation: 'Ja, der Bestätigungsfehler ist die Tendenz, unbewusst nach Informationen zu suchen, die die eigenen Überzeugungen bestätigen.'
                },
                 {
                    type: 'multiple-choice',
                    question: 'Ist es immer eine schlechte Idee, sich eine Meinung auf Basis von Google-Suchergebnissen zu bilden?',
                    options: [
                        { text: 'Ja.', isCorrect: false },
                        { text: 'Nein.', isCorrect: true }
                    ],
                    explanation: 'Nein, es ist nicht immer eine schlechte Idee. Suchmaschinen-Algorithmen können den Bestätigungsfehler verstärken, aber das ist kein Grund, die Ergebnisse nicht zu nutzen. Man sollte sich nur bewusst sein, dass die Ergebnisse tendenziell die eigene Meinung bestätigen.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Wenn eine Webseite in ihrem Impressum keine Autoren oder Verantwortlichen angibt, macht dies die Quelle nach dem CRAAP-Test automatisch unzuverlässig?',
                    options: [
                        { text: 'Ja.', isCorrect: true },
                        { text: 'Nein.', isCorrect: false }
                    ],
                    explanation: 'Ja, das Fehlen von Autoren oder einer verantwortlichen Organisation ist ein wichtiges Warnsignal im Rahmen des CRAAP-Tests.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Was ist der wahrscheinlichste Zweck einer Quelle, die versucht, Ihnen ein Produkt oder eine Dienstleistung zu verkaufen?',
                    options: [
                        { text: 'Sachlich informieren.', isCorrect: false },
                        { text: 'Eine Meinung überzeugen.', isCorrect: false },
                        { text: 'Ein Produkt oder eine Dienstleistung verkaufen.', isCorrect: true },
                        { text: 'Unterhalten.', isCorrect: false }
                    ],
                    explanation: 'Der Zweck (Purpose) einer Quelle ist ein wichtiges Kriterium im CRAAP-Test. Eine Quelle, die etwas verkauft, hat primär den Zweck, den Leser zum Kauf zu überreden.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Nach den Prinzipien des objektiven Recherchierens, was ist ein wichtiger Schritt, um ein ausgewogenes Urteil zu bilden?',
                    options: [
                        { text: 'Nur Quellen suchen, die die eigene Meinung bestätigen.', isCorrect: false },
                        { text: 'Fakten recherchieren und bereit sein, neue Informationen zuzulassen.', isCorrect: true },
                        { text: 'Die erste gefundene Information als endgültige Wahrheit akzeptieren.', isCorrect: false },
                        { text: 'Emotionale Appelle als Beweise verwenden.', isCorrect: false }
                    ],
                    explanation: 'Objektives Recherchieren erfordert die Bereitschaft, Fakten zu suchen und zu akzeptieren, auch wenn sie den eigenen Überzeugungen widersprechen.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Beim CRAAP-Test, was bewertet das Kriterium "Relevance" (Relevanz)?',
                    options: [
                        { text: 'Das Veröffentlichungsdatum der Quelle.', isCorrect: false },
                        { text: 'Die Wichtigkeit der Informationen für Ihre Fragestellung.', isCorrect: true },
                        { text: 'Die Erfahrung des Autors.', isCorrect: false },
                        { text: 'Die Genauigkeit der Fakten.', isCorrect: false }
                    ],
                    explanation: 'Das Relevanz-Kriterium des CRAAP-Tests bewertet, wie gut eine Quelle Ihre spezifische Fragestellung oder Ihr Thema beantwortet.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Welcher Zweck hat die Verwendung von Anführungszeichen (`" "`) in einer Google-Suche?',
                    options: [
                        { text: 'Um Synonyme für den Suchbegriff zu finden.', isCorrect: false },
                        { text: 'Um die Suche auf Bilder zu beschränken.', isCorrect: false },
                        { text: 'Um nach der exakten Wortgruppe zu suchen.', isCorrect: true },
                        { text: 'Um Begriffe von der Suche auszuschließen.', isCorrect: false }
                    ],
                    explanation: 'Anführungszeichen zwingen Google, nur Ergebnisse zu liefern, die die exakte Wortgruppe enthalten.'
                },
                {
                    type: 'multiple-choice',
                    question: 'Welches CRAAP-Kriterium würde eine Quelle mit übertriebener, emotionaler Sprache am ehesten verletzen?',
                    options: [
                        { text: 'Accuracy (Genauigkeit).', isCorrect: false },
                        { text: 'Relevance (Relevanz).', isCorrect: false },
                        { text: 'Purpose (Zweck).', isCorrect: true },
                        { text: 'Currency (Aktualität).', isCorrect: false }
                    ],
                    explanation: 'Die Verwendung von übertriebener, emotionaler Sprache ist ein starker Hinweis darauf, dass der Zweck (Purpose) der Quelle nicht darin besteht, sachlich zu informieren, sondern zu überzeugen oder eine bestimmte emotionale Reaktion hervorzurufen.'
                }
            ];
            
            let currentQuestionIndex = 0;
            let attempts = 0;
            let results = [];
            let isEvaluating = false;
            let retryQuestionIndex = null;
            
            // Definiere die maximalen Versuche
            const MAX_MC_ATTEMPTS = 2;
            const MAX_TEXT_ATTEMPTS = 3;

            startButton.addEventListener('click', () => {
                startScreen.classList.add('hidden');
                quizArea.classList.remove('hidden');
                // Zufällige Reihenfolge der Fragen für mehr Abwechslung
                quizData.sort(() => Math.random() - 0.5); 
                initializeProgressBar();
                renderQuestion();
            });
            
            floatingHintButton.addEventListener('click', () => {
                 const qIndex = retryQuestionIndex !== null ? retryQuestionIndex : currentQuestionIndex;
                 const questionData = quizData[qIndex];
                 // Zeige den Tipp nur, wenn es eine Textfrage ist
                 if (questionData.type === 'text') {
                     handleHint(questionData.hint);
                 }
            });


            function initializeProgressBar() {
                progressBarContainer.innerHTML = '';
                quizData.forEach((_, index) => {
                    const segment = document.createElement('div');
                    segment.classList.add('progress-segment');
                    segment.setAttribute('data-index', index);
                    progressBarContainer.appendChild(segment);
                });
                progressBarContainer.addEventListener('click', handleProgressBarClick);
            }

            function handleProgressBarClick(event) {
                const target = event.target;
                if (target.classList.contains('progress-segment')) {
                    const index = parseInt(target.getAttribute('data-index'), 10);
                    
                    if (index >= currentQuestionIndex) {
                        return;
                    }
                    
                    const result = results.find(r => r.questionIndex === index);
                    
                    if (result && !result.wasCorrect) {
                        retryQuestionIndex = index;
                        attempts = 0;
                        // Entferne den Endbildschirm, falls vorhanden, um zum Quiz zurückzukehren
                        if (document.getElementById('final-screen')) {
                            document.getElementById('final-screen').remove();
                        }
                        document.getElementById('quiz-container').classList.remove('hidden');
                        quizArea.classList.remove('hidden');
                        renderQuestion();
                    }
                }
            }

            function updateProgressBarColor(index, status) {
                const segment = progressBarContainer.querySelector(`[data-index="${index}"]`);
                if (segment) {
                    // NEUE FARBEN-MAP für Fortschrittsanzeige
                    if (status === 'correct') {
                        segment.style.backgroundColor = '#AFD0BF'; // Ash Gray (Success)
                    } else if (status === 'incorrect') {
                        segment.style.backgroundColor = '#EF4444'; // Rot (Fehler)
                    } else if (status === 'skipped') {
                        segment.style.backgroundColor = '#9B7E46'; // Chamoisee (Übersprungen/Sekundär)
                    }
                }
            }

            function updateQuestionCounter() {
                 const qIndex = retryQuestionIndex !== null ? retryQuestionIndex : currentQuestionIndex;
                 questionCounterElement.textContent = `Frage ${qIndex + 1} von ${quizData.length}`;
            }
            
            function updateFeedbackAttempts() {
                const qIndex = retryQuestionIndex !== null ? retryQuestionIndex : currentQuestionIndex;
                const questionData = quizData[qIndex];
                const maxAttempts = questionData.type === 'text' ? MAX_TEXT_ATTEMPTS : MAX_MC_ATTEMPTS;

                if (questionData.type === 'text') {
                    feedbackAttempts.textContent = `Versuch ${attempts + 1} von ${maxAttempts} (Recherche/Rechnung)`; 
                } else if (retryQuestionIndex === null) {
                    feedbackAttempts.textContent = `Versuch ${attempts + 1} von ${maxAttempts}`;
                } else {
                     feedbackAttempts.textContent = `Wiederholungsversuch ${attempts + 1} von ${maxAttempts}`;
                }
                
                // Wichtig: Tipp beim Wechsel der Frage zurücksetzen
                hintDisplay.classList.add('hidden'); 
                feedbackElement.classList.remove('text-red-500', 'text-green-600');
            }

            function renderQuestion() {
                if (currentQuestionIndex >= quizData.length && retryQuestionIndex === null) {
                    showFinalEvaluation();
                    // Wenn das Quiz beendet ist, Floating Button ausblenden
                    floatingHintButton.classList.add('hidden');
                    return;
                }
                
                const qIndex = retryQuestionIndex !== null ? retryQuestionIndex : currentQuestionIndex;
                const questionData = quizData[qIndex];
                
                updateQuestionCounter();
                updateFeedbackAttempts();

                questionArea.innerHTML = '';
                feedbackElement.textContent = '';
                nextButton.classList.add('hidden');
                hintDisplay.classList.add('hidden'); // Tipp beim Rendern ausblenden
                
                // Skip Button nur anzeigen, wenn es kein Wiederholungsversuch ist
                if(retryQuestionIndex === null) {
                   skipButton.classList.remove('hidden');
                   skipButton.textContent = 'Frage überspringen';
                } else {
                   skipButton.classList.add('hidden'); 
                }
                
                // Floating Hint Button steuern
                if (questionData.type === 'text') {
                    floatingHintButton.classList.remove('hidden');
                } else {
                    floatingHintButton.classList.add('hidden');
                }


                const questionWrapper = document.createElement('div');
                questionWrapper.classList.add('bg-gray-50', 'p-8', 'rounded-lg', 'shadow-lg', 'relative');

                const questionText = document.createElement('p');
                questionText.classList.add('text-2xl', 'font-medium', 'text-gray-800', 'mb-6');
                questionText.textContent = questionData.question;
                questionWrapper.appendChild(questionText);
                
                // Füge eine Notiz für Recherche/Rechnungs-Fragen hinzu
                if (questionData.type === 'text') {
                     const researchNote = document.createElement('p');
                     researchNote.classList.add('text-sm', 'text-gray-500', 'mb-4', 'italic');
                     // Geändertes wording: Hinweis auf den schwebenden Button
                     researchNote.textContent = 'Hinweis: Für diese Frage ist ggf. eine Recherche oder Rechnung notwendig. Der Tipp ( ?) ist rechts unten sichtbar.';
                     questionWrapper.appendChild(researchNote);
                }

                if (questionData.type === 'multiple-choice') {
                    questionData.options.forEach(option => {
                        const button = document.createElement('button');
                        button.textContent = option.text;
                        // Styling für Buttons auf Desktop
                        button.classList.add('w-full', 'py-4', 'px-6', 'my-3', 'bg-gray-200', 'rounded-lg', 'text-gray-800', 'font-semibold', 'hover:bg-gray-300', 'transition-colors', 'shadow-md', 'text-left');
                        button.onclick = () => handleChoiceAnswer(option.isCorrect, questionData.explanation, button);
                        questionWrapper.appendChild(button);
                    });
                } else if (questionData.type === 'text') {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.placeholder = questionData.placeholder;
                    // Styling für Input auf Desktop
                    input.classList.add('w-full', 'py-4', 'px-6', 'my-3', 'text-lg', 'bg-gray-100', 'rounded-lg', 'border', 'border-gray-300', 'focus:outline-none', 'focus:ring-2', 'focus:ring-[#9B7E46]'); // Focus Ring: Chamoisee
                    questionWrapper.appendChild(input);

                    const submitButton = document.createElement('button');
                    submitButton.textContent = 'Antwort abschicken';
                    // Styling für Submit Button auf Desktop (Chamoisee)
                    submitButton.classList.add('w-full', 'py-4', 'px-6', 'mt-4', 'bg-[#9B7E46]', 'text-white', 'font-semibold', 'text-lg', 'rounded-lg', 'shadow-lg', 'hover:bg-[#81693A]', 'transition-colors');
                    submitButton.onclick = () => {
                        const userAnswer = input.value.trim();
                        // Wenn der Benutzer nichts eingibt, wird es als "Überspringen" behandelt
                        if (userAnswer === '') {
                           handleSkip();
                           return;
                        }
                        const isCorrect = questionData.correctAnswerCheck(userAnswer);
                        handleTextAnswer(isCorrect, questionData.explanation, submitButton);
                    };
                    questionWrapper.appendChild(submitButton);
                }

                questionArea.appendChild(questionWrapper);
                
                // MathJax nach dem Einfügen des HTML neu rendern
                MathJax.typesetPromise([questionText]).catch(function (err) {
                    console.error('MathJax rendering failed:', err);
                });
            }
            
            function handleHint(hintTextContent) {
                 hintText.textContent = hintTextContent;
                 hintDisplay.classList.toggle('hidden'); // Tipp ein-/ausblenden
            }

            function handleChoiceAnswer(isCorrect, explanation, element) {
                if (isEvaluating) return;

                const qIndex = retryQuestionIndex !== null ? retryQuestionIndex : currentQuestionIndex;
                const questionData = quizData[qIndex];
                const maxAttempts = MAX_MC_ATTEMPTS; // 2 Versuche für MC

                if (isCorrect) {
                    feedbackElement.textContent = 'Richtig! Sehr gut.';
                    feedbackElement.classList.remove('text-red-500');
                    feedbackElement.classList.add('text-green-600'); 
                    disableAllOptions();
                    element.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                    element.classList.add('bg-[#AFD0BF]', 'text-gray-800'); // Ash Gray (Success-Hintergrund)
                    
                    // Speichern des Ergebnisses
                    if (retryQuestionIndex === null) {
                       results.push({ questionIndex: qIndex, wasCorrect: true, isSkipped: false, correctAnswer: questionData.correctAnswer || (questionData.options.find(o => o.isCorrect)?.text || '') });
                    } else {
                       const resultIndex = results.findIndex(r => r.questionIndex === qIndex);
                       if (resultIndex !== -1) {
                           results[resultIndex].wasCorrect = true;
                           results[resultIndex].isSkipped = false;
                       }
                    }

                    updateProgressBarColor(qIndex, 'correct');

                    setTimeout(() => {
                        // Tipp beim Wechsel zur nächsten Frage ausblenden
                        floatingHintButton.classList.add('hidden');
                        
                        if (retryQuestionIndex !== null) {
                            retryQuestionIndex = null;
                            showFinalEvaluation(); // Zurück zum Endbildschirm nach erfolgreicher Wiederholung
                        } else {
                            currentQuestionIndex++;
                            attempts = 0;
                            renderQuestion();
                        }
                    }, 1500); // Kürzere Wartezeit für besseren Spielfluss
                } else {
                    attempts++;
                    element.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                    element.classList.add('bg-red-200'); // Falsche Antwort rot hinterlegen
                    
                    if (attempts < maxAttempts) {
                        feedbackElement.textContent = `Falsch. Du hast noch ${maxAttempts - attempts} Versuch(e).`;
                        feedbackElement.classList.remove('text-green-600');
                        feedbackElement.classList.add('text-red-500');
                        updateFeedbackAttempts(); // Aktualisiert die Anzeige des Versuchs
                        updateProgressBarColor(qIndex, 'incorrect');
                    } else {
                        feedbackElement.innerHTML = `Falsch. <span class="font-normal block mt-2 text-base">Die Erklärung: ${explanation}</span>`;
                        feedbackElement.classList.remove('text-green-600');
                        feedbackElement.classList.add('text-red-500');
                        disableAllOptions();
                        nextButton.classList.remove('hidden');
                        skipButton.classList.add('hidden');
                        updateProgressBarColor(qIndex, 'incorrect');
                        
                        // Ergebnis als falsch speichern, wenn kein Wiederholungsversuch
                        if (retryQuestionIndex === null) {
                           results.push({ questionIndex: qIndex, wasCorrect: false, isSkipped: false, correctAnswer: questionData.correctAnswer || (questionData.options.find(o => o.isCorrect)?.text || '') });
                        }
                    }
                }
            }
            
            function handleTextAnswer(isCorrect, explanation, element) {
                 if (isEvaluating) return;

                const qIndex = retryQuestionIndex !== null ? retryQuestionIndex : currentQuestionIndex;
                const questionData = quizData[qIndex];
                const maxAttempts = MAX_TEXT_ATTEMPTS; // 3 Versuche für Recherche

                if (isCorrect) {
                    feedbackElement.textContent = 'Richtig! Sehr gut.';
                    feedbackElement.classList.remove('text-red-500');
                    feedbackElement.classList.add('text-green-600');
                    element.disabled = true;
                    questionArea.querySelector('input').disabled = true;

                    // Speichern des Ergebnisses
                    if (retryQuestionIndex === null) {
                       results.push({ questionIndex: qIndex, wasCorrect: true, isSkipped: false, correctAnswer: questionData.correctAnswer });
                    } else {
                       const resultIndex = results.findIndex(r => r.questionIndex === qIndex);
                       if (resultIndex !== -1) {
                           results[resultIndex].wasCorrect = true;
                           results[resultIndex].isSkipped = false;
                       }
                    }

                    updateProgressBarColor(qIndex, 'correct');

                    setTimeout(() => {
                        // Tipp beim Wechsel zur nächsten Frage ausblenden
                        floatingHintButton.classList.add('hidden');
                        
                        if (retryQuestionIndex !== null) {
                            retryQuestionIndex = null;
                            showFinalEvaluation();
                        } else {
                            currentQuestionIndex++;
                            attempts = 0;
                            renderQuestion();
                        }
                    }, 1500);

                } else {
                    attempts++;
                    if (attempts < maxAttempts) {
                        feedbackElement.textContent = `Falsch. Du hast noch ${maxAttempts - attempts} Versuch(e).`;
                        feedbackElement.classList.remove('text-green-600');
                        feedbackElement.classList.add('text-red-500');
                        updateFeedbackAttempts(); // Aktualisiert die Anzeige des Versuchs
                        updateProgressBarColor(qIndex, 'incorrect');
                    } else {
                        // Nach dem letzten Versuch
                        feedbackElement.innerHTML = `Falsch. <span class="font-normal block mt-2 text-base">Die Erklärung: ${explanation}</span>`;
                        feedbackElement.classList.remove('text-green-600');
                        feedbackElement.classList.add('text-red-500');
                        element.disabled = true;
                        questionArea.querySelector('input').disabled = true;
                        
                        // Hint Button ausblenden, da es keine Versuche mehr gibt
                        floatingHintButton.classList.add('hidden');
                        hintDisplay.classList.add('hidden');
                        
                        nextButton.classList.remove('hidden');
                        skipButton.classList.add('hidden');
                        updateProgressBarColor(qIndex, 'incorrect');

                         // Ergebnis als falsch speichern, wenn kein Wiederholungsversuch
                         if (retryQuestionIndex === null) {
                           results.push({ questionIndex: qIndex, wasCorrect: false, isSkipped: false, correctAnswer: questionData.correctAnswer });
                        }
                    }
                }
            }

            function handleSkip() {
                const qIndex = retryQuestionIndex !== null ? retryQuestionIndex : currentQuestionIndex;
                const questionData = quizData[qIndex];
                
                // Überspringen ist nur beim ersten Durchgang möglich
                if (retryQuestionIndex !== null) return;

                feedbackElement.textContent = 'Frage übersprungen. Du kannst sie später wiederholen.';
                feedbackElement.classList.remove('text-green-600', 'text-red-500');
                
                if (retryQuestionIndex === null) {
                    results.push({ questionIndex: qIndex, wasCorrect: false, isSkipped: true, correctAnswer: questionData.correctAnswer || (questionData.options.find(o => o.isCorrect)?.text || '') });
                }

                updateProgressBarColor(qIndex, 'skipped');
                
                disableAllOptions();
                nextButton.classList.remove('hidden');
                skipButton.classList.add('hidden');
                hintDisplay.classList.add('hidden'); // Tipp ausblenden

                setTimeout(() => {
                    // Tipp beim Wechsel zur nächsten Frage ausblenden
                    floatingHintButton.classList.add('hidden');
                    
                    currentQuestionIndex++;
                    attempts = 0;
                    renderQuestion();
                }, 1000);
            }

            function disableAllOptions() {
                const options = questionArea.querySelectorAll('button, input');
                options.forEach(option => {
                    option.disabled = true;
                    // Entferne Click-Handler nur bei Buttons, Input-Feld behält Submit-Button-Logik
                    if (option.tagName === 'BUTTON' && option.id !== 'submit-answer') {
                        option.onclick = null;
                    }
                });
            }

            nextButton.addEventListener('click', () => {
                // Tipp beim Wechsel zur nächsten Frage ausblenden
                floatingHintButton.classList.add('hidden');
                
                if (retryQuestionIndex !== null) {
                    // Wenn wir eine Frage wiederholt haben und sie falsch war, gehen wir zurück zur Auswertung.
                    retryQuestionIndex = null;
                    showFinalEvaluation();
                } else {
                    currentQuestionIndex++;
                    attempts = 0;
                    renderQuestion();
                }
            });
            
            skipButton.addEventListener('click', handleSkip);

            function showFinalEvaluation() {
                isEvaluating = true;
                // Wichtig: Floating Button im Endbildschirm ausblenden
                floatingHintButton.classList.add('hidden');
                
                const totalQuestions = quizData.length;
                const correctAnswers = results.filter(r => r.wasCorrect).length;
                const incorrectAttempts = results.filter(r => !r.wasCorrect && !r.isSkipped).length;
                const skippedQuestions = results.filter(r => r.isSkipped).length;

                quizArea.classList.add('hidden');
                
                // Stelle sicher, dass der Container sichtbar ist
                const quizContainer = document.getElementById('quiz-container');
                quizContainer.classList.remove('hidden');
                
                const finalScreen = document.createElement('div');
                finalScreen.id = 'final-screen';
                finalScreen.classList.add('text-center', 'p-8', 'space-y-6');
                finalScreen.innerHTML = `
                    <h2 class="text-3xl font-extrabold mb-4 text-[#808F87]">Quiz beendet! 🎉</h2>
                    <!-- NEUE SUCCESS/ACCENT FARBE: Ash Gray -->
                    <p class="text-2xl font-bold text-[#AFD0BF]">Finales Ergebnis:</p>
                    <!-- NEUE ACCENT FARBE: Chamoisee -->
                    <p class="text-xl font-medium text-gray-800">Du hast <span class="text-[#9B7E46]">${correctAnswers}</span> von ${totalQuestions} Fragen richtig beantwortet.</p>
                    
                    <div class="grid grid-cols-3 gap-4 text-lg">
                        <!-- Richtig: Ash Gray | Falsch: Standard Rot | Übersprungen: Chamoisee -->
                        <div class="p-4 bg-green-50 rounded-lg shadow-sm">Richtig: <span class="font-bold text-[#AFD0BF]">${correctAnswers}</span></div>
                        <div class="p-4 bg-red-50 rounded-lg shadow-sm">Falsch: <span class="font-bold text-red-600">${incorrectAttempts}</span></div>
                        <div class="p-4 bg-yellow-50 rounded-lg shadow-sm">Übersprungen: <span class="font-bold text-[#9B7E46]">${skippedQuestions}</span></div>
                    </div>
                    
                    <!-- NEUE PRIMÄRFARBE: Chamoisee -->
                    <button id="restart-button" class="bg-[#9B7E46] text-white font-semibold py-4 px-8 text-lg rounded-lg shadow-lg hover:bg-[#81693A] transition-colors w-full md:w-auto mt-4">
                        Quiz neu starten
                    </button>
                `;
                quizContainer.appendChild(finalScreen);

                document.getElementById('restart-button').addEventListener('click', () => {
                    window.location.reload();
                });
                
                // Logik für Wiederholungsfragen
                const questionsToRetry = results.filter(r => !r.wasCorrect);
                if (questionsToRetry.length > 0) {
                    const retryList = document.createElement('div');
                    retryList.classList.add('mt-10', 'text-left');
                    retryList.innerHTML = `<h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2 border-gray-200">Fragen zum Wiederholen:</h3>`;
                    
                    questionsToRetry.forEach((item) => {
                        const questionItem = document.createElement('div');
                        questionItem.classList.add('mb-4', 'p-4', 'rounded-lg', 'border-2', 'cursor-pointer', 'transition-all', 'hover:shadow-md');
                        
                        let statusText = '';
                        if (item.isSkipped) {
                            // NEUE ACCENT FARBE: Chamoisee
                            statusText = `<span class="text-[#9B7E46] font-bold">Übersprungen</span>`;
                            questionItem.classList.add('bg-yellow-50', 'border-yellow-300');
                        } else {
                            statusText = `<span class="text-red-700 font-bold">Falsch beantwortet</span>`;
                            questionItem.classList.add('bg-red-50', 'border-red-300');
                        }

                        questionItem.innerHTML = `
                            <p class="font-bold mb-1">${statusText}</p>
                            <p class="text-gray-700">${quizData[item.questionIndex].question}</p>
                            <p class="text-sm text-gray-500 mt-2">Klicken zum Wiederholen</p>
                        `;
                        questionItem.addEventListener('click', () => {
                            isEvaluating = false;
                            retryQuestionIndex = item.questionIndex;
                            document.getElementById('final-screen').remove();
                            quizArea.classList.remove('hidden');
                            attempts = 0; // Setze Versuche für die Wiederholung zurück
                            renderQuestion();
                        });
                        retryList.appendChild(questionItem);
                    });
                    finalScreen.appendChild(retryList);
                }
                feedbackElement.textContent = '';
                feedbackAttempts.textContent = '';
                nextButton.classList.add('hidden');
                skipButton.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
